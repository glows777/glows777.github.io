# TCP

## 三次挥手与四次握手

## 基本格式

- ![小林coding图片](https://cdn.xiaolincoding.com//mysql/other/format,png-20230309230534096.png)

### 序列号

- 在建立连接时，由计算机生成的随机数，通过SYN包传送给接收方，每一次发送数据，就累加一次
- 发送端，接收端各自随机生成一个
- 用于解决网络包乱序的问题

### 确认应答号

- 下一次期望收到的数据序列号
- 发送端在收到这个应答后，可以认为在这个序列号之前的数据都被正确接收
- 用于解决丢包问题

### 控制位

#### ACK

- 位为1时，确认应答的字段变得有效
- 在TCP中，规定除了最初简历连接的SYN包之外，这个位的值必须是1

#### RST

- 位为1时，表示TCP连接出现异常，必须强制断开

#### SYN

- 位为1时，表示希望建立连接，
- 同时，会在其*序列号*的字段进行序列号的初始化

#### FIN

- 位为1时， 表示今后不再会有数据发送，希望断开连接
- 当想要断开连接时，双方的主机之间就可以交换FIN位为1的TCP报文

## TCP的特点

### 面向连接

- 一对一的连接，无法一对多

### 可靠的

- TCP尽自己的所能，保证报文到达接收端
- 但是，只能在运输层上保证？？

### 字节流

### 如何确定一个TCP连接？

- 通过一个TCP四元组可以确定一个TCP连接
- 他们分别是
  - 源地址
  - 端口
  - 目的地址
  - 目的端口

## TCP与UDP的区别

### 基本区别

- TCP需要建立连接才能传输数据，而UDP则是即刻传输
- TCP是一对一的连接，而UDP可以一对多，多对多的交互通信
- TCP通过一系列手段可靠交付数据，而UDP尽最大努力交付，**但不保证可靠**
- TCP有流量，拥塞控制等机制，保证数据传输，而UDP没有，所以即使网络很差，也不会影响UDP的**发送速率**
- TCP的头部较大，而且不定长，UDP头部固定，只有8个字节
- TCP是流式传输，无边界，但是安全可靠，UDP则是一个包一个包的发送，有边界，可能会导致丢包和乱序

### 应用场景

- TCP提供可靠的传输，所以会用于一些注重完整性的场景，如
  - http
  - ftp
- UDP面向无连接，处理起来较为高效，所以一般用于对实时性要求比较高的场景
  - 包总量较少的DNS，SNMP
  - 视频，音频等多媒体传输
  - 广播

## TCP如何建立，断开连接

### 三次握手

- 

### 四次挥手

## 其他一些问题

### TCP和UDP可以用同个端口吗

- 答案是可以的
- 在数据链路层中，通过mac地址来寻找局域网中的主机，而在网络层中，通过IP地址来寻找网络中互联的路由器或者主机，在传输层中，通过端口来寻找同一计算机的不同程序
- 端口号的作用就是区分不同程序的数据包
- 在计算机收到IP报文后，会在IP报文的包头【协议号】的字段中知道，是哪一种类型的传输层协议，然后再分发给不同的模块处理（TCP去TCP模块，UDP去UDP模块）
- 所以，TCP和UDP的端口是互相独立的

---

## 参考链接

- 小林coding [链接](https://www.xiaolincoding.com/network/3_tcp/tcp_interview.html#tcp-%E5%A4%B4%E6%A0%BC%E5%BC%8F%E6%9C%89%E5%93%AA%E4%BA%9B) 

---



